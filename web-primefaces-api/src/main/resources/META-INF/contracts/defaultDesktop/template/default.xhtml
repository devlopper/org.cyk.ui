<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions">
 
    <h:head>
    	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    	<!-- Error : Not Found - Check how it comes -->
    	<!--
    	<link href="#{request.contextPath}/contracts/defaultDesktop/css/default.css" rel="stylesheet" type="text/css"/>
    	<link href="#{request.contextPath}/contracts/defaultDesktop/css/common.css" rel="stylesheet" type="text/css"/>
		-->
		
		
		<link type="text/css" rel="stylesheet" href="#{request.contextPath}/javax.faces.resource/css/common.css.jsf?ln=org.cyk.ui.web.primefaces" />
		
		<!--
		<ui:repeat var="link" value="#{webManager.headLinks}">
			<link type="text/css" rel="stylesheet" href="#{request.contextPath}/javax.faces.resource/#{link}" />
		</ui:repeat>
		-->
		<title>
			<h:outputText value="#{uiManager.application.name}" rendered="#{not empty uiManager.application.name}"/>
			<h:outputText value=" - " rendered="#{not empty uiManager.application.name and not empty pageController.title}" />
			<h:outputText value="#{pageController.title}" rendered="#{not empty pageController.title}"/>
			
		</title>
		
		<h:outputScript library="org.cyk.ui.web.primefaces" name="js/head.js" target="head"/>

		<!-- <script type="text/javascript">
	        $(document).ready(function() {
	        	//Ready
	        	#{pageController.onDocumentReadyJavaScript}
	        	//Loaded
	        	$(window).on('load', function() { #{pageController.onDocumentLoadJavaScript} });
	        	//Before unloadind
	        	$(window).bind('beforeunload', function(){
					#{pageController.onDocumentBeforeUnLoadJavaScript}
					//the custom message for page unload doesn't work on Firefox
					if(#{pageController.onDocumentBeforeUnLoadWarnAsString})
						return '#{pageController.onDocumentBeforeUnLoadWarningMessage}';
				
				});
			});
	        
	        function preview(input,previewId) {
 		        if (input.files &amp;&amp; input.files[0]) {
 		            var reader = new FileReader();
 		            reader.onload = function (e) {
 		                $('#'+previewId).attr('src', e.target.result);
 		            }
 		            reader.readAsDataURL(input.files[0]);
 		        }
 		    }
	        
	        function playSound(soundfile) {
				document.getElementById("dummysound").
					innerHTML='<embed src="'+soundfile+'" hidden="true" autostart="true" loop="false" />';
			}
	     </script>  -->
	     <ui:include src="/org.cyk.ui.web.primefaces/include/js/head.xhtml" />
    </h:head>
    
    <ui:insert name="metadata"/>
 
	<h:body>
		<ui:include src="#{webManager.decoratedTemplateInclude}" />
		<h:outputScript library="org.cyk.ui.web.primefaces" name="js/primefaces.js" />
		
		<!--p:growl id="notificationGrowl" showDetail="true" sticky="true" escape="false" globalOnly="true" /-->
		
		<!-- pushing -->
		<!--
		<p:growl widgetVar="#{primefacesManager.pushChannelGlobalGrowlWidgetVar}" showDetail="true" sticky="true" escape="false" />
		<p:socket onMessage="handlePushChannelGlobalMessage" channel="#{primefacesManager.pushChannelGlobal}" />
		-->
		
		<span id="dummysound"></span>
		<h:form>
			<p:growl id="notificationChannelGrowlId" widgetVar="#{primefacesManager.notificationChannelGrowlWidgetVar}" 
				showDetail="true" sticky="true" escape="false" globalOnly="true"  />
			<p:remoteCommand id="notificationRemoteCommand" name="updateNotifications" actionListener="#{userSession.showNotifications}" update="notificationChannelGrowlId" />
		</h:form>
		<p:socket widgetVar="#{primefacesManager.notificationChannelSocketWidgetVar}" autoConnect="true" 
			channel="/#{uiManager.pushNotificationChannel}/#{userSession.userAccount.identifier}" 
			onMessage="handleNotificationMessage" />
		
		<pe:layout fullPage="true" options="#{webPageLayoutManager.options}" styleClass="mainlayout">
			<pe:layoutPane position="north"  styleClassContent="mainnorthpanecontent bordernone" rendered="#{pageController.showMainMenu}"><h:form id="formNorth">
				<ui:include src="#{defaultDesktopLayoutManager.northInclude}" />
			</h:form></pe:layoutPane>
			
			<pe:layoutPane position="west" styleClassContent="westcenterpanecontent" rendered="#{pageController.showContextualMenu}">
				<h:form id="contextualMenuForm">
					<ui:insert name="westContent">
						<ui:include src="#{defaultDesktopLayoutManager.westInclude}" />
					</ui:insert>
				</h:form>
			</pe:layoutPane>
			
			<pe:layoutPane id="contentPane" position="center" styleClassContent="maincenterpanecontent" >
				<f:facet name="header"><h:outputText value="#{pageController.contentTitle}" /> </f:facet>
			 	<h:form id="form" enctype="multipart/form-data" >
				 	<pe:layoutPane id="contentp" position="center">
				 		<p:outputPanel id="contentPanel">
				 			<p:messages id="messages" globalOnly="true" escape="false"/>
				 			<ui:insert name="centerContent"><h:outputText value="Main content." /></ui:insert>
				 			<!-- Messages -->
							<p:outputPanel id="messagePanel" autoUpdate="true">
								<p:dialog id="messageDialogId" widgetVar="#{webManager.messageDialogWidgetId}" header="#{uiManager.text('information')}" modal="true" appendTo="@(body)" 
									visible="#{not empty facesContext.messageList}" draggable="false" resizable="false" closable="false">
									<table style="margin: auto;" cellspacing="5">
										<tr style="vertical-align: middle;">
											<td class="ui-datalist-bordernone"><p:dataList value="#{facesContext.messageList}" var="message" rowIndexVar="index" 
												type="#{uiManager.collectionSize(facesContext.messageList)==1?'none':'ordered'}" >
												<ui:include src="/org.cyk.ui.web.primefaces/include/message.xhtml">
													<ui:param name="severity" value="#{webManager.facesMessageSeverity(message)}" />
													<ui:param name="message" value="#{message.summary}" />
												</ui:include>
											</p:dataList></td>
										</tr>
										<tr>
											<td colspan="1">
												<p:separator/>
												<div align="center">
													<p:commandButton value="OK" type="button" icon="ui-icon-check" 
														onclick="PF('#{webManager.messageDialogWidgetId}').hide();#{pageController.messageDialogOkButtonOnClick}" />
												</div>
											</td>
										</tr>
									</table>
								</p:dialog>
							</p:outputPanel>
				 		</p:outputPanel>
				 	</pe:layoutPane>
				 	
				 	<pe:layoutPane id="commandp" position="south" styleClassContent="maincenterpanecontentformmenubar ui-widget-header ui-corner-top pe-layout-pane-header" rendered="#{pageController.showContentMenu}">
						<p:outputPanel id="menuPanel" style="padding-left: 5px !important;padding-top: 2px !important;">
							<ui:insert name="contentMenuBar">
								<p:menubar id="menubar" model="#{pageController.contentMenuModel}" styleClass="maincenterpanecontentformmenubar"/>
							</ui:insert>
						</p:outputPanel>
				 	</pe:layoutPane>
				 	
				 	<!-- Status -->
					<p:ajaxStatus onstart="PF('#{webManager.blockUIDialogWidgetId}').show();" oncomplete="PF('#{webManager.blockUIDialogWidgetId}').hide();" />
					<p:dialog modal="true" widgetVar="#{webManager.blockUIDialogWidgetId}" resizable="false" closable="false" 
						draggable="false" appendTo="@(body)" header="#{uiManager.text('information')}">
						<table><tr style="vertical-align: middle;">
							<td><h:outputText value="#{uiManager.text('processing.request')}" /></td>
							<td><p:graphicImage library="org.cyk.ui.web.primefaces" name="images/processing.gif" alt="#{uiManager.text('processing.request')}"/>  </td>
						</tr> </table>
					</p:dialog>
				</h:form>
			</pe:layoutPane>
			
			<pe:layoutPane id="footerlayoutpaneid" position="south" resizable="false" closable="false" styleClassContent="footerpanecontent bordernone" 
				rendered="#{pageController.showFooter}">
				<ui:insert name="southContent">
					<div style="text-align: center;font-size: 11px;font-weight: bold;width: 100%;" class="ui-panel-titlebar ui-widget-header ui-helper-clearfix">
						<h:outputText value="#{pageController.footer}" escape="false"/>
					</div>
				</ui:insert>
			</pe:layoutPane>
			
		</pe:layout> 
 		
 		<h:outputScript>
 			$ = jQuery;
			
	    	function clickEditButtonLastRow(dataTableStyleClass){
	    		$('.'+dataTableStyleClass+' div.ui-datatable-tablewrapper table tbody.ui-datatable-data tr.ui-widget-content').last().find('td div.ui-row-editor span.ui-icon-pencil').each(function(){
					 $(this).click();	
				});
				
			}
			
			function clickEditButtonAllRow(dataTableStyleClass){
				$('.'+dataTableStyleClass+' div.ui-datatable-tablewrapper table tbody.ui-datatable-data tr.ui-widget-content').find('td div.ui-row-editor span.ui-icon-pencil').each(function(){
					 $(this).click();	
				});
			}
			
			function hideAllRowEditorButtons(dataTableStyleClass){
				$('.'+dataTableStyleClass+' div.ui-datatable-tablewrapper table tbody.ui-datatable-data tr.ui-widget-content').find('div.ui-row-editor').each(function(){
					 $(this).display='none';
					 $(this).visible='false';
					 $(this).visibility='hidden';	
				});
			}			
			
			function clickEditButtonRow(dataTableStyleClass,rowIndex){
				$('.'+dataTableStyleClass+' div.ui-datatable-tablewrapper table tbody.ui-datatable-data tr.ui-widget-content:nth-child('+rowIndex+')').find('td div.ui-row-editor span.ui-icon-pencil').each(function(){
					 $(this).click();	
				});
			}
			
			
			function confirmDialog(){
	    		PF('confirmDialogWidgetVar').show();
			}
			
			function blockUIStart() {
			    PF('#{webManager.blockUIDialogWidgetId}').show();
			}
			 
			function blockUIStop() {
			    PF('#{webManager.blockUIDialogWidgetId}').hide();
			}
			
			function handleNotificationMessage(facesMessage) { 
				playSound('#{resource['org.cyk.ui.web.primefaces/sound/messageincoming.mp3']}'); 
				updateNotifications(); 
			}
			
		</h:outputScript>
 		
 		
 		
    </h:body>
</html>
