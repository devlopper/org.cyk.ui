<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:cc="http://xmlns.jcp.org/jsf/composite"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:cyk="http://xmlns.jcp.org/jsf/composite/org.cyk.ui.web.primefaces/component">

	<cc:interface componentType="org.cyk.ui.web.primefaces.compositecomponent.Table">
		<cc:attribute name="value" required="true" />
	</cc:interface>

	<cc:implementation>
		<ui:param name="updateDataTableStyleClass" value="#{cc.value.updateStyleClass}" />
		<ui:param name="controlDir" value="/org.cyk.ui.web.primefaces/include/control" />
		<!--
		<p:menubar model="#{cc.value.menuModel}" /> 
		-->
		<!--
		<cyk:command value="#{cc.value.primefacesAddRowCommand}" />
		-->
		<!--
		<table style="width: 100%;"><tr style="vertical-align: top;">
		-->
			<!--
			<ui:fragment rendered="#{cc.value.showHierarchy}"><td style="width: 1%;">
				<cyk:tree value="#{cc.value.primefacesTree}" />
			</td></ui:fragment>
			-->
			<!--<td>--><p:dataTable id="dataTable" var="row" value="#{cc.value.rows}" editable="#{cc.value.editable}" 
				styleClass="dataTableStyleClass #{updateDataTableStyleClass}" rowIndexVar="index"
				emptyMessage="#{uiManager.text('record.list.empty')}">
				
				<p:ajax event="rowEditInit" listener="#{cc.value.onRowEditInit}" />
				<p:ajax event="rowEdit" listener="#{cc.value.onRowEdit}"  />
				<p:ajax event="rowEditCancel" listener="#{cc.value.onRowEditCancel}" />
				
				<!-- sortBy="#{column.fieldName}" filterBy="#{column.fieldName}" -->
				<p:columns value="#{cc.value.columns}" var="column" columnIndexVar="colIndex" >  
		            <f:facet name="header"><h:outputText value="#{column.title}" /></f:facet>  
		  			<ui:param name="templateFile" value="/org.cyk.ui.web.primefaces/template/control/messageAtTop.xhtml" />
		  			<!--
		  			<ui:param name="data" value="#{cc.value.cell(row,column).control}" />
		  			-->
		  			
		  			<p:cellEditor>
		  				<f:facet name="input">
		  					
		  					<!-- 
		  					<ui:include src="#{primefacesManager.includeFile(cc.value.cell(row,column).control)}" >
		  						<ui:param name="data" value="#{cc.value.cell(row,column).control}" />
		  					</ui:include>
		  					-->
		  					
		  					<ui:fragment rendered="#{uiProvider.isControl(cc.value.cell(row,column).control,'InputText')}" ><ui:include src="#{controlDir}/input/inputText.xhtml" >
		  						<ui:param name="control" value="#{cc.value.cell(row,column).control}" />
		  					</ui:include></ui:fragment>
		  					
		  					<ui:fragment rendered="#{uiProvider.isControl(cc.value.cell(row,column).control,'InputOneCombo')}" ><ui:include src="#{controlDir}/input/choice/one/inputOneCombo.xhtml" >
		  						<ui:param name="data" value="#{cc.value.cell(row,column).control}" />
		  					</ui:include></ui:fragment>
		  					
		  					<ui:fragment rendered="#{uiProvider.isControl(cc.value.cell(row,column).control,'InputNumber')}" ><ui:include src="#{controlDir}/input/inputNumber.xhtml" >
		  						<ui:param name="data" value="#{cc.value.cell(row,column).control}" />
		  					</ui:include></ui:fragment>
		  					
		  				</f:facet>
		  				<f:facet name="output">
		  					<h:outputText value="#{cc.value.cell(row,column)}" escape="false"/>
		  				</f:facet>
		  			</p:cellEditor>
		        </p:columns> 
		        
		        <p:column rendered="#{cc.value.editable}" width="30">
		        	<p:rowEditor rendered="#{cc.value.inplaceEdit}" />
		        	<cyk:command value="#{cc.value.crudOneRowCommandable}" executeParameter="#{row}" rendered="#{not cc.value.inplaceEdit}"/>
		        </p:column>
		        
		        <p:column rendered="#{cc.value.editable}" width="60">
		        	<table><tr>
		        		<td style="border: none;"><cyk:command value="#{cc.value.removeRowCommandable}" executeParameter="#{row}" /></td>
		        		<ui:fragment rendered="#{cc.value.showOpenCommand}" ><td style="border: none;">
		        			<cyk:command value="#{cc.value.openRowCommandable}" executeParameter="#{row}" />
		        		</td></ui:fragment>
		        	</tr></table>
		        </p:column>
		        
			</p:dataTable><!--</td>-->
		
		<!--</tr> </table>-->
		<p:outputPanel rendered="#{cc.value.showFooterCommandBlock}" >
			<cyk:command value="#{cc.value.addRowCommandable}" />	
		</p:outputPanel>
				
	</cc:implementation>

</ui:composition>